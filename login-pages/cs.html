<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>Digital Earth ‚Ä¢ Changsha Target</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0" />
    <style>
      html,
      body {
        margin: 0;
        overflow: hidden;
        background: #000;
        font-family: Segoe UI;
      }
      canvas {
        position: fixed;
        top: 0;
        left: 0;
      }
      .label {
        position: absolute;
        color: #0ff;
        font-size: 14px;
        pointer-events: none;
        text-shadow: 0 0 10px #0ff;
      }
    </style>
  </head>
  <body>
    <div
      class="label"
      id="label">
      üìç ÈïøÊ≤ô CHANGSHA
    </div>

    <script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>

    <script>
      /* ========== Âü∫Á°Ä ========== */
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(
        60,
        innerWidth / innerHeight,
        0.1,
        1000
      );
      camera.position.z = 4;
      const renderer = new THREE.WebGLRenderer({antialias: true, alpha: true});
      renderer.setSize(innerWidth, innerHeight);
      document.body.appendChild(renderer.domElement);

      scene.add(new THREE.AmbientLight(0x4477ff, 0.6));
      const light = new THREE.DirectionalLight(0xffffff, 1);
      light.position.set(5, 3, 5);
      scene.add(light);

      const earthGroup = new THREE.Group();
      scene.add(earthGroup);

      const R = 1;

      /* ========== Â∑•ÂÖ∑ÂáΩÊï∞ ========== */
      function latLngToVec3(lat, lon, r = R) {
        lat *= Math.PI / 180;
        lon *= Math.PI / 180;
        return new THREE.Vector3(
          r * Math.cos(lat) * Math.cos(lon),
          r * Math.sin(lat),
          r * Math.cos(lat) * Math.sin(lon)
        );
      }

      /* ========== Âú∞ÁêÉ ========== */
      earthGroup.add(
        new THREE.Mesh(
          new THREE.SphereGeometry(R, 64, 64),
          new THREE.MeshStandardMaterial({
            map: new THREE.TextureLoader().load(
              'https://threejs.org/examples/textures/land_ocean_ice_cloud_2048.jpg'
            ),
            emissive: 0x112244,
            emissiveIntensity: 0.3
          })
        )
      );

      /* ========== ‰∏≠ÂõΩ & ÈïøÊ≤ô ========== */
      const CHANGSHA = {lat: 28.2282, lon: 112.9388};

      /* ÂüéÂ∏ÇÁÇπ */
      const city = latLngToVec3(CHANGSHA.lat, CHANGSHA.lon, 1.02);
      const cityMesh = new THREE.Mesh(
        new THREE.SphereGeometry(0.02, 16, 16),
        new THREE.MeshBasicMaterial({color: 0xffcc00})
      );
      cityMesh.position.copy(city);
      earthGroup.add(cityMesh);

      /* ========== È£ûÁ∫øÔºàÂÖ®ÁêÉ ‚Üí ÈïøÊ≤ôÔºâ ========== */
      function createFlyLine(start, end, color) {
        const mid = start.clone().add(end).multiplyScalar(0.5);
        mid.normalize().multiplyScalar(1.5);

        const curve = new THREE.QuadraticBezierCurve3(start, mid, end);
        const points = curve.getPoints(100);
        const geo = new THREE.BufferGeometry().setFromPoints(points);
        const mat = new THREE.LineBasicMaterial({
          color,
          transparent: true,
          opacity: 0.8
        });
        return new THREE.Line(geo, mat);
      }

      const fromWorld = latLngToVec3(40, -100, 1.01);
      const flyLine = createFlyLine(fromWorld, city, 0x00ffff);
      earthGroup.add(flyLine);

      /* ========== Âç´ÊòüËΩ®ÈÅì ========== */
      const orbitGeo = new THREE.TorusGeometry(1.3, 0.002, 16, 100);
      const orbit = new THREE.Mesh(
        orbitGeo,
        new THREE.MeshBasicMaterial({color: 0x00aaff})
      );
      orbit.rotation.x = Math.PI / 2;
      earthGroup.add(orbit);

      /* Âç´Êòü */
      const sat = new THREE.Mesh(
        new THREE.SphereGeometry(0.01, 8, 8),
        new THREE.MeshBasicMaterial({color: 0xffffff})
      );
      earthGroup.add(sat);

      /* ========== Âä®Áîª ========== */
      let t = 0;
      let focus = false;

      function animate() {
        requestAnimationFrame(animate);
        earthGroup.rotation.y += 0.001;

        // Âç´ÊòüËøêÂä®
        t += 0.01;
        sat.position.set(Math.cos(t) * 1.3, 0, Math.sin(t) * 1.3);

        // ËÅöÁÑ¶ÈïøÊ≤ô
        if (focus) {
          const target = latLngToVec3(CHANGSHA.lat, CHANGSHA.lon, 4);
          camera.position.lerp(target, 0.02);
          camera.lookAt(0, 0, 0);
        }

        // Ê†áÁ≠æ
        const p = city.clone().project(camera);
        label.style.left = (p.x * 0.5 + 0.5) * innerWidth + 'px';
        label.style.top = (-p.y * 0.5 + 0.5) * innerHeight + 'px';

        renderer.render(scene, camera);
      }
      animate();

      /* ========== Ëá™Âä®ËÅöÁÑ¶ÈïøÊ≤ô ========== */
      setTimeout(() => (focus = true), 1500);

      onresize = () => {
        camera.aspect = innerWidth / innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(innerWidth, innerHeight);
      };
    </script>
  </body>
</html>
